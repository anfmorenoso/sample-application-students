language: java
jdk: oraclejdk8

# Define the services to use
services:
  - docker

before_install:
  - sudo service mysql stop
  - docker pull takimatraining/devops-training-db
  - docker run -d -p 127.0.0.1:3306:3306 takimatraining/devops-training-db

# Run Unit Test and Integration Tests
script:
  - mvn verify

# Cache the .m2 folder to prevent redownloading dependencies on each build
cache:
  directories:
  - "$HOME/.m2/repository"

env:
  global:
    - secure: "oe3IVzeNg+cFvd8IW3SlzhNPDsK5ZKD28Fl3zoMXqCvcqXdE0bdUDLfPEYLrQ12VTYtOgoJDG9qCWSIEWHiQRDlZSBe+29mLHjBPQENojxBIABU97zAZTNAgU6lca5e9zTD8w0tK8NjrnN7PMLkxvNFRudXk0KcobU54CnLQUtK41D9KuIwpBTsB2uo4IW8K860zBeLj+Lxgd82pIOEkUCRQU8S7pJCj6N7CYl5z4H5fjj+3V+eddBYSnoZKoGHLTV3RjBhXjpH3WlOymxf9z1ZobcJEpiNnsE1492SKhkaF0AlQAKQarB1jD4zsGINBHgDE7ssFTvStrMUvG4IQg5byXgpFfwEUOkac61sRUQbDkaDHtt1MBUXL6pbYUAQTFhpj0T4fFpsjDRnm4LbhDlZxzAu0E7nJ6+m4W4IihaFdCh2OPuI7iDGY5UcjFnZvtVjl1+vs3GrB6FepUmc+d0hAQ7GJrFXgoixzwRa+f+GXNiTuC9O6lEpdZlZiU2/WRnGzo81aR+A7iNk2GTktalZx3rDjqa7In0slKtkOFw65SDgQ073ECQFbXhFIKysE02Gy16CE1/XUm2y8enGiqDUdVrIRSrfNlspMKoDk7Ha5BQX/wSOqsbQGOJZoyCR5jFlKnteN/TPkRxghuoSbNIshPXePDUQQo9RTQFkJXLY="

# The pipe (|) is useful to create multiline scripts
script:
  - |
    mvn clean install sonar:sonar \
    -Dsonar.projectKey=anfmorenoso_sample-application-students \
    -Dsonar.organization=anfmorenoso-github \
    -Dsonar.host.url=https://sonarcloud.io \
    -Dsonar.login=$SONAR_TOKEN
